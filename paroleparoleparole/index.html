<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gioco di Videoscrittura</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        #gameContainer {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        
        #setupScreen {
            text-align: center;
        }
        
        #setupScreen label {
            font-size: 1.2em;
            color: #333;
            display: block;
            margin-bottom: 15px;
        }
        
        #minutesInput {
            font-size: 1.5em;
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            width: 150px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        #startBtn {
            font-size: 1.2em;
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #startBtn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        #gameScreen {
            display: none;
        }
        
        #stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        #canvas {
            display: block;
            margin: 0 auto;
            border: 3px solid #667eea;
            border-radius: 10px;
            background: white;
        }
        
        #gameOver {
            display: none;
            text-align: center;
        }
        
        #finalScore {
            font-size: 3em;
            color: #667eea;
            margin: 20px 0;
        }
        
        #restartBtn {
            font-size: 1.2em;
            padding: 15px 40px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        #restartBtn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .loading {
            text-align: center;
            color: #666;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <h1>ðŸŽ® Gioco di Videoscrittura</h1>
        
        <div id="setupScreen">
            <label for="minutesInput">Imposta i minuti di gioco:</label>
            <input type="number" id="minutesInput" min="1" max="30" value="2">
            <br>
            <button id="startBtn">Inizia il Gioco</button>
            <div class="loading" id="loadingMsg" style="display:none;">Caricamento parole...</div>
        </div>
        
        <div id="gameScreen">
            <div id="stats">
                <div class="stat">
                    <div class="stat-label">Tempo</div>
                    <div class="stat-value" id="timer">0:00</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Punteggio</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Parole</div>
                    <div class="stat-value" id="wordsCount">0</div>
                </div>
            </div>
            <canvas id="canvas" width="700" height="400"></canvas>
        </div>
        
        <div id="gameOver">
            <h2>Tempo Scaduto!</h2>
            <div id="finalScore"></div>
            <p>Parole completate: <span id="finalWords"></span></p>
            <button id="restartBtn">Gioca Ancora</button>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            words: [],
            currentWord: null,
            typedText: '',
            score: 0,
            wordsCompleted: 0,
            timeLeft: 0,
            gameActive: false,
            wordList: [],
            flashRed: false,
            flashCount: 0
        };
        
        // Ampio database di parole italiane integrate
        function loadWords() {
            const allWords = [
        'abaco', 'abate', 'abbaglio', 'abbaiare', 'abbandonare', 'abbassare', 'abbastanza', 'abbattere',
        'abbazia', 'abbellire', 'abbinare', 'abboccare', 'abbondante', 'abbonare', 'abbordare', 'abbottonare',
        'abbozzare', 'abbracciare', 'abbreviare', 'abbronzare', 'abete', 'abile', 'abilitÃ ', 'abisso',
        'abitante', 'abitare', 'abito', 'abitudine', 'abnegare', 'abolire', 'abrasivo', 'abrogare',
        'abside', 'abulico', 'abusare', 'abuso', 'acacia', 'accademia', 'accadere', 'accalcare',
        'accampare', 'accanire', 'accanto', 'accarezzare', 'accasare', 'accattone', 'accavallare', 'accecare',
        'accelerare', 'accendere', 'accennare', 'accento', 'accerchiare', 'accertare', 'accessorio', 'accesso',
        'accettare', 'acchiappare', 'acciacco', 'acciaio', 'accidente', 'accidioso', 'acciuga', 'acclamare',
        'accludere', 'accogliere', 'accollare', 'accomodare', 'accompagnare', 'acconciare',
        'babbo', 'babbeo', 'babordo', 'bacato', 'bacca', 'baccano', 'baccello', 'bacchetta',
        'baciare', 'bacio', 'baco', 'badare', 'badessa', 'badia', 'badile', 'baffo',
        'bagaglio', 'baggiano', 'bagliore', 'bagnare', 'bagno', 'baia', 'baita', 'balaustro',
        'balbuzie', 'balcone', 'baldacchino', 'baldanza', 'baldoria', 'balena', 'balenare', 'baleno',
        'balestra', 'balia', 'balilla', 'balista', 'balla', 'ballare', 'ballata', 'ballerino',
        'balletto', 'ballo', 'balordaggine', 'balordo', 'balsamo', 'baluardo', 'balza', 'balzare',
        'balzello', 'bambagia', 'bambina', 'bambino', 'bambola', 'banale', 'banana', 'banca',
        'banchetto', 'banchiere', 'banchina', 'banco', 'bancone', 'banda', 'bandiera', 'bandire',
        'bandito', 'bando', 'bandolo', 'bara', 'baracca', 'barare',
        'cabala', 'cabina', 'cacao', 'caccia', 'cacciare', 'cacciatore', 'cacciatora', 'cachetto',
        'cadavere', 'cadente', 'cadenza', 'cadere', 'cadetto', 'caduceo', 'caduta', 'caffÃ¨',
        'cagionare', 'cagione', 'cagnara', 'cagnesco', 'cagnolino', 'cagnotto', 'caimano', 'calabrone',
        'calamaio', 'calamaro', 'calamitÃ ', 'calamita', 'calare', 'calca', 'calcagno', 'calcare',
        'calce', 'calciare', 'calcio', 'calcinaccio', 'calcolare', 'calcolo', 'caldaia', 'caldana',
        'caldano', 'caldeggiare', 'caldo', 'calendario', 'calende', 'calesse', 'calibro', 'calice',
        'caligine', 'calla', 'callaia', 'calle', 'calligrafia', 'callo', 'calma', 'calmare',
        'calmo', 'calo', 'calore', 'caloroso', 'calotta', 'calpestare', 'calunnia', 'calura',
        'calvo', 'calza', 'calzare', 'calzatura', 'calzerotto', 'calzetta',
        'dabbasso', 'dabbene', 'dacchÃ©', 'dado', 'daffare', 'dagli', 'daino', 'dalla',
        'dalmata', 'dama', 'damasco', 'damigella', 'damigiana', 'damma', 'dannare', 'dannato',
        'danno', 'dannoso', 'dantesco', 'danza', 'danzare', 'dappiÃ©', 'dappiÃ¹', 'dappoco',
        'dappoichÃ©', 'dapprima', 'dappresso', 'dapprima', 'dardo', 'dare', 'darsena', 'data',
        'datare', 'dativo', 'dato', 'datore', 'datteri', 'dattero', 'dattorno', 'dattorno',
        'davanti', 'davanzale', 'davvero', 'dazio', 'daziere', 'debellare', 'debilitare', 'debito',
        'debitore', 'debole', 'debolezza', 'debosciato', 'debuttare', 'decade', 'decadenza', 'decadere',
        'decaffeinato', 'decalcare', 'decalogo', 'decampare', 'decano', 'decantare', 'decapitare', 'decente',
        'decesso', 'decidere', 'decifrare', 'decimare', 'decimo', 'decina',
        'ebanista', 'ebano', 'ebbene', 'ebbrezza', 'ebbro', 'ebdomada', 'ebete', 'ebollire',
        'ebraico', 'ebreo', 'eburneo', 'ecatombe', 'eccedente', 'eccedere', 'eccellente', 'eccellenza',
        'eccellere', 'eccelso', 'eccentrico', 'eccessivo', 'eccesso', 'eccetera', 'eccetto', 'eccettuare',
        'eccheggiare', 'ecchimosi', 'eccidio', 'eccitare', 'ecclesiastico', 'eclettice', 'eclissare', 'eclisse',
        'eclittica', 'economo', 'economia', 'economico', 'economizzare', 'eczema', 'edace', 'edema',
        'edera', 'edicola', 'edificare', 'edificio', 'edile', 'edilizia', 'editare', 'editore',
        'editto', 'edizione', 'educare', 'educato', 'educazione', 'effeminato', 'efferato', 'effervescente',
        'effettivo', 'effetto', 'effettuare', 'efficace', 'efficacia', 'efficiente', 'effigie', 'effimero',
        'effluente', 'effluire', 'effluvio', 'effondere', 'effrazione', 'effusione',
        'fabbrica', 'fabbricare', 'fabbricato', 'fabbricatore', 'fabbro', 'fabbisogno', 'faccenda', 'faccendiere',
        'faccetta', 'facchino', 'faccia', 'facciata', 'facezia', 'faceto', 'fachiro', 'facile',
        'facilitÃ ', 'facilitare', 'facilone', 'facinoroso', 'facitore', 'facoltÃ ', 'facoltativo', 'facoltoso',
        'faconda', 'facondo', 'facsimile', 'faggio', 'fagiano', 'fagiolino', 'fagiolo', 'fagliolo',
        'fagotto', 'falange', 'falce', 'falcetto', 'falciare', 'falciatore', 'falciatrice', 'falcione',
        'falco', 'falconiere', 'falda', 'falegname', 'falena', 'fallace', 'fallacia', 'fallare',
        'fallibile', 'fallimento', 'fallire', 'fallito', 'fallo', 'falÃ²', 'falsare', 'falsario',
        'falsetto', 'falsificare', 'falsitÃ ', 'falso', 'fama', 'fame', 'famelico', 'famiglia',
        'famigliare', 'familiare', 'familiaritÃ ', 'famoso', 'fanale', 'fanalino',
        'gabbare', 'gabbamondo', 'gabbare', 'gabbia', 'gabbiano', 'gabbiere', 'gabbo', 'gabella',
        'gabellare', 'gabelliere', 'gabinetto', 'gaetano', 'gaffa', 'gaggia', 'gaggiolo', 'gagliardo',
        'gaglioffo', 'gagnolare', 'gaio', 'gaiezza', 'gala', 'galante', 'galanteria', 'galantuomo',
        'galassia', 'galateo', 'galeazza', 'galeotto', 'galera', 'galeone', 'galla', 'gallare',
        'galleggiare', 'galleria', 'galletto', 'gallina', 'gallinaccio', 'gallinella', 'gallo', 'gallone',
        'gallonare', 'gallonaio', 'galloria', 'gallozzola', 'galone', 'galoppo', 'galoppare', 'galoppino',
        'galoscia', 'galvanizzare', 'gamba', 'gambale', 'gambero', 'gambo', 'gamella', 'gamma',
        'ganascia', 'gancio', 'ganghero', 'ganglio', 'ganza', 'ganzo', 'gara', 'garante',
        'garantire', 'garanzia', 'garbare', 'garbato', 'garbo', 'garbuglio',
        'habitat', 'habituÃ©', 'handicap', 'hangar', 'happening', 'harem', 'hardware', 'harmattan',
        'hashish', 'havana', 'hawaiano', 'heavy', 'herpes', 'hertz', 'hi-fi', 'himalayano',
        'hindi', 'hippy', 'hit', 'hobbista', 'hobby', 'hockey', 'holding', 'home',
        'homo', 'honoris', 'horror', 'hostess', 'hotel', 'humus', 'hurrÃ ', 'husky',
        'habitat', 'habitus', 'hacker', 'hacking', 'haiku', 'hall', 'hamburger', 'hamlet',
        'hammam', 'handicappato', 'handler', 'handsome', 'hangover', 'happy', 'harakiri', 'harbinger',
        'hardcore', 'hardtop', 'hareem', 'haricot', 'harmonic', 'harmony', 'harness', 'harp',
        'harpoon', 'harridan', 'harvest', 'hash', 'hassle', 'haste', 'hasty', 'hatch',
        'hatchback', 'hatchet', 'hate', 'hateful', 'hatred', 'haughty',
        'iarda', 'iato', 'iberico', 'ibernare', 'ibisco', 'ibrido', 'icona', 'iconico',
        'iddio', 'idea', 'ideale', 'idealismo', 'idealista', 'ideare', 'identico', 'identificare',
        'identitÃ ', 'ideologia', 'idillio', 'idioma', 'idiota', 'idolatria', 'idolo', 'idoneitÃ ',
        'idoneo', 'idra', 'idraulica', 'idraulico', 'idroelettrico', 'idrofilo', 'idrofobia', 'idrogeno',
        'idrografia', 'idromele', 'idropisia', 'idroscalo', 'idrosfera', 'idrovolante', 'iella', 'iemale',
        'iena', 'ieratico', 'iernatico', 'iersera', 'ieri', 'iettare', 'iettatore', 'iettatura',
        'igiene', 'igienico', 'ignaro', 'ignavia', 'igneo', 'ignicolo', 'ignifugo', 'ignobile',
        'ignominia', 'ignorante', 'ignoranza', 'ignorare', 'ignoto', 'ignudo', 'ilare', 'ilaritÃ ',
        'ileso', 'iliaco', 'illanguidire', 'illazione', 'illecito', 'illegale',
        'labbro', 'laberinto', 'labile', 'laboratorio', 'laborioso', 'labirinto', 'lacca', 'laccio',
        'lacerare', 'lacero', 'laconico', 'lacrima', 'lacrimare', 'lacrimevole', 'lacrimoso', 'lacuna',
        'lacustre', 'ladro', 'ladreria', 'ladrocinio', 'ladroncello', 'ladrone', 'laggiÃ ', 'laggiÃ¹',
        'lagna', 'lagnanza', 'lagnare', 'lagnarsi', 'lagnoso', 'lago', 'laguna', 'lagunare',
        'laico', 'laido', 'lama', 'lambiccare', 'lambiccato', 'lambicco', 'lambire', 'lamella',
        'lamentanza', 'lamentare', 'lamentazione', 'lamentevole', 'lamento', 'lamentoso', 'lamiera', 'lamina',
        'lampada', 'lampadario', 'lampana', 'lampante', 'lampeggiare', 'lampo', 'lampone', 'lampreda',
        'lana', 'lancetta', 'lancia', 'lanciare', 'lanciere', 'lancio', 'landa', 'languente',
        'languidezza', 'languido', 'languire', 'languore', 'lanificio', 'lanoso',
        'macabro', 'macao', 'maccare', 'maccheroni', 'macchia', 'macchiare', 'macchiato', 'macchietta',
        'macchina', 'macchinare', 'macchinario', 'macchinazione', 'macchinista', 'macchioso', 'macedonia', 'macellare',
        'macelleria', 'macello', 'macerare', 'maceria', 'macero', 'macigno', 'macilento', 'macinare',
        'macinato', 'macinino', 'macinio', 'macrocosmo', 'macula', 'madia', 'madido', 'madonna',
        'madornale', 'madre', 'madreperla', 'madreselva', 'madrigale', 'madrina', 'maestra', 'maestranza',
        'maestrevole', 'maestria', 'maestro', 'maestoso', 'maffia', 'magagna', 'magagnare', 'magari',
        'magazzinaggio', 'magazziniere', 'magazzino', 'maggio', 'maggiolino', 'maggioranza', 'maggiorare', 'maggiordomo',
        'maggiore', 'maggiorenne', 'maggiormente', 'magia', 'magico', 'magione', 'magistero', 'magistrale',
        'magistrato', 'magistratura', 'maglia', 'magliaia', 'maglieria', 'maglietta',
        'nabisso', 'nacchere', 'nafta', 'naiade', 'nano', 'nanetto', 'nanna', 'nannare',
        'napoleone', 'napoletano', 'nappa', 'narciso', 'narice', 'narrare', 'narrativa', 'narratore',
        'narrazione', 'nasale', 'nascente', 'nascere', 'nascimento', 'nascita', 'nascondere', 'nascondiglio',
        'nascondino', 'nascoso', 'nascosto', 'nasello', 'naso', 'nassa', 'nassare', 'nasso',
        'nastro', 'nasturzio', 'natale', 'natalizio', 'natante', 'natare', 'natatoia', 'natio',
        'nativo', 'nato', 'natrice', 'natura', 'naturale', 'naturalezza', 'naturalismo', 'naturalista',
        'naturalizzare', 'naturalmente', 'naufragare', 'naufragio', 'naufrago', 'nausea', 'nauseabondo', 'nauseante',
        'nauseare', 'nautica', 'nautico', 'navale', 'navata', 'nave', 'navetta', 'navicella',
        'navigabile', 'navigante', 'navigare', 'navigatore', 'navigazione', 'naviglio', 'navile', 'nazionale',
        'oasi', 'obbediente', 'obbedienza', 'obbedire', 'obbiettare', 'obbiettivo', 'obbietto', 'obbligante',
        'obbligare', 'obbligato', 'obbligatorio', 'obbligazione', 'obbligo', 'obbrobrioso', 'obbrobrio', 'obelia',
        'obelisco', 'oberare', 'obesitÃ ', 'obeso', 'obiettare', 'obiettivo', 'obietto', 'obiezione',
        'obitorio', 'oblare', 'oblato', 'oblazione', 'obliare', 'oblio', 'obliquo', 'obliterare',
        'oblÃ²', 'oblungo', 'obnubilare', 'obolo', 'oca', 'ocarina', 'occasionale', 'occasionare',
        'occasione', 'occhiale', 'occhiata', 'occhiato', 'occhiatura', 'occhiello', 'occhio', 'occhiuto',
        'occidentale', 'occidente', 'occipite', 'occludere', 'occorrente', 'occorrenza', 'occorrere', 'occorso',
        'occultare', 'occultazione', 'occulto', 'occupante', 'occupare', 'occupato', 'occupazione', 'oceanico',
        'oceano', 'ocra', 'oculare', 'oculatezza', 'oculato', 'oculista', 'oculate', 'ode',
        'pacato', 'pacca', 'pacchetto', 'pacchia', 'pacco', 'pace', 'pacifico', 'pacificare',
        'pacioccone', 'padella', 'padellata', 'padiglione', 'padre', 'padrenostro', 'padreterno', 'padrino',
        'padrone', 'padronale', 'padronanza', 'padroneggiare', 'paesaggio', 'paesano', 'paese', 'paesello',
        'paffuto', 'paga', 'pagabile', 'pagamento', 'paganesimo', 'pagano', 'pagare', 'pagatore',
        'paggio', 'paggetto', 'paglia', 'pagliaio', 'pagliaccio', 'paglietta', 'paglierino', 'paglierina',
        'paglino', 'pagliuzza', 'pagnotta', 'pago', 'pagoda', 'paio', 'paiolo', 'paiuolo',
        'pala', 'paladino', 'palaffitta', 'palafreno', 'palafreniere', 'palamito', 'palanca', 'palanchino',
        'palancola', 'palanco', 'palare', 'palata', 'palatale', 'palatino', 'palato', 'palazzo',
        'palazzina', 'palchetto', 'palco', 'palcoscenico', 'palesare', 'palese', 'palestra',
        'qua', 'quacchero', 'quaderno', 'quadrante', 'quadrare', 'quadrato', 'quadratura', 'quadrello',
        'quadretto', 'quadrilatero', 'quadriglia', 'quadrimensionale', 'quadrimestre', 'quadrivio', 'quadro', 'quadrone',
        'quadrupede', 'quadruplice', 'quaggiÃ¹', 'quaglia', 'quagliare', 'qualche', 'qualcheduno', 'qualcosa',
        'qualcuno', 'quale', 'qualifica', 'qualificare', 'qualificato', 'qualificazione', 'qualitÃ ', 'qualitativo',
        'qualora', 'qualsiasi', 'qualunque', 'qualvolta', 'quando', 'quandonchessia', 'quantitÃ ', 'quantitativo',
        'quanto', 'quantunque', 'quaranta', 'quarantena', 'quarantesimo', 'quarantina', 'quarare', 'quaresima',
        'quaresimale', 'quartana', 'quartetto', 'quartiere', 'quartierino', 'quartina', 'quarto', 'quartogenito',
        'quartultimo', 'quarzo', 'quasi', 'quassÃ¹', 'quaternario', 'quaterna', 'quattordici', 'quattordicenne',
         'quattrini', 'quattro', 'quattrino', 'quegli', 'quei', 'quella',
        'rabarbaro', 'rabberciare', 'rabbia', 'rabbino', 'rabbioso', 'rabbonire', 'rabbuiare', 'rabbuffare',
        'rabdomante', 'rabescato', 'rabesco', 'raccapezzare', 'raccapriccio', 'raccattare', 'racchetta',
        'racchiudere', 'racchio', 'raccia', 'raccogliere', 'raccoglimento', 'raccoglitore', 'raccolmandare', 'raccolmandazione',
        'raccolta', 'raccolto', 'raccomandare', 'raccomandatario', 'raccomandato', 'raccomandazione', 'raccomodare', 'racconciare',
        'raccontare', 'raccontino', 'racconto', 'raccorciare', 'raccordare', 'raccordo', 'raccostare', 'raccozzare',
        'rachitide', 'rachitico', 'racimolare', 'racquistare', 'rada', 'radar', 'raddensare', 'raddobbare',
        'raddolcire', 'raddomandare', 'raddoppiare', 'raddrizzare', 'radente', 'radere', 'radezza', 'radiale',
        'radiante', 'radiare', 'radiatore', 'radicale', 'radicamento', 'radicare', 'radicato', 'radice',
        'radicella', 'radicina', 'radio', 'radioattivo', 'radiodiffusione', 'radiofonia', 'radiografia',
        'sabato', 'sabba', 'sabbia', 'sabbiare', 'sabbioso', 'sabbione', 'sabotaggio', 'sabotare',
        'saburra', 'sacca', 'saccardo', 'saccente', 'saccheggiare', 'saccheggio', 'sacchetto', 'sacco',
        'saccoccio', 'saccone', 'sacello', 'sacerdote', 'sacerdotale', 'sacerdozio', 'sacramentale', 'sacramentare',
        'sacramento', 'sacrare', 'sacrario', 'sacrificare', 'sacrificio', 'sacrilegio', 'sacrilego', 'sacrista',
        'sacristano', 'sacristia', 'sacro', 'sacrosanto', 'sadico', 'sadismo', 'saetta', 'saettare',
        'saettia', 'sagace', 'sagacia', 'saggezza', 'saggiare', 'saggiatore', 'saggio', 'saggina',
        'saggista', 'sagittario', 'sagola', 'sagoma', 'sagomare', 'sagra', 'sagrato', 'sagresta',
        'sagrestano', 'sagrestia', 'sagrificio', 'saia', 'saio', 'sala', 'salace', 'salamandra',
        'salamelecco', 'salamoia', 'salare', 'salario', 'salariato', 'salassare', 'salasso',
        'tabacco', 'tabaccaio', 'tabaccheria', 'tabaccherio', 'tabacchiera', 'tabacchiere', 'tabaccoso', 'tabarro',
        'tabella', 'tabellare', 'tabellione', 'tabernacolo', 'taberna', 'taberniere', 'tabescere', 'tabida',
        'tabido', 'tabo', 'tabÃ¹', 'tabulare', 'tacca', 'taccagno', 'taccare', 'tacchegggio',
        'tacchetto', 'tacchino', 'taccia', 'taccio', 'taccola', 'taccolare', 'tacco', 'taccone',
        'taccuino', 'tacere', 'tachimetro', 'tacitare', 'taciturno', 'tacito', 'taciuto', 'tacola',
        'tacquare', 'tafanare', 'tafano', 'tafferia', 'tafferuglio', 'taffettÃ ', 'tafia', 'taglia',
        'tagliaborse', 'tagliaboschi', 'tagliacantoni', 'tagliacarte', 'tagliaerba', 'tagliafuoco', 'taglialegna', 'tagliamano',
        'tagliapanni', 'tagliapietra', 'tagliare', 'tagliata', 'tagliatella', 'tagliatelle', 'tagliato', 'tagliatore',
        'taglieggiare', 'tagliente', 'tagliere', 'taglio', 'tagliola', 'tagliuola',
        'ubbidiente', 'ubbidienza', 'ubbidire', 'ubbia', 'ubbioso', 'ubertÃ ', 'ubertoso', 'ubicare',
        'ubicazione', 'ubiquitÃ ', 'ubriacare', 'ubriachezza', 'ubriaco', 'uccellaccio', 'uccellaglia', 'uccellaia',
        'uccellaio', 'uccellame', 'uccellare', 'uccellato', 'uccellatore', 'uccellatura', 'uccelliera', 'uccellino',
        'uccello', 'uccellone', 'uccidere', 'uccidersi', 'uccisione', 'ucciso', 'uccisore', 'udenza',
        'udibile', 'udienza', 'udire', 'uditore', 'uditorio', 'udito', 'uffa', 'ufficiale',
        'ufficio', 'ufficiositÃ ', 'ufficioso', 'uffiziale', 'uffizio', 'ugello', 'uggere', 'uggia',
        'uggioso', 'uggiolare', 'uggiolo', 'uggire', 'ugnare', 'ugnere', 'ugola', 'uguaglianza',
        'uguagliare', 'uguale', 'ugualmente', 'ulano', 'ulcera', 'ulcerare', 'ulceroso', 'ulerioso',
        'ulignoso', 'uligine', 'uliginoso', 'uliva', 'ulivare', 'uliveto', 'ulivigno'
				];
            
            // Mescola e restituisce tutte le parole
            return Promise.resolve(allWords.sort(() => Math.random() - 0.5));
        }
        
        function getRandomWord() {
            if (gameState.wordList.length === 0) return 'errore';
            return gameState.wordList[Math.floor(Math.random() * gameState.wordList.length)];
        }
        
        function createNewWord() {
            const word = getRandomWord();
            
            // Calcola la larghezza approssimativa della parola
            ctx.font = 'bold 32px Arial';
            const wordWidth = ctx.measureText(word).width;
            
            // Margini di sicurezza
            const marginX = 20;
            const marginY = 40;
            
            return {
                text: word,
                x: Math.random() * (canvas.width - wordWidth - marginX * 2) + marginX,
                y: Math.random() * (canvas.height - marginY * 2) + marginY,
                completed: false
            };
        }
        
        function drawWord(word) {
            ctx.font = 'bold 32px Arial';
            
            // Disegna le lettere non ancora digitate
            let xOffset = 0;
            for (let i = 0; i < word.text.length; i++) {
                const char = word.text[i];
                
                if (i < gameState.typedText.length) {
                    // Lettere giÃ  digitate (verdi)
                    ctx.fillStyle = '#10b981';
                } else {
                    // Lettere da digitare (nere o rosse se errore)
                    ctx.fillStyle = gameState.flashRed ? '#ef4444' : '#333';
                }
                
                ctx.fillText(char, word.x + xOffset, word.y);
                xOffset += ctx.measureText(char).width;
            }
        }
        
        function updateTimer() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('wordsCount').textContent = gameState.wordsCompleted;
        }
        
        function draw() {
            // Pulisci canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Disegna la parola corrente
            if (gameState.currentWord) {
                drawWord(gameState.currentWord);
            }
            
            // Gestisci il lampeggio rosso
            if (gameState.flashRed) {
                gameState.flashCount++;
                if (gameState.flashCount > 15) {
                    gameState.flashRed = false;
                    gameState.flashCount = 0;
                }
            }
        }
        
        function gameLoop() {
            if (!gameState.gameActive) return;
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        function endGame() {
            gameState.gameActive = false;
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('finalScore').textContent = gameState.score + ' punti';
            document.getElementById('finalWords').textContent = gameState.wordsCompleted;
        }
        
        async function startGame() {
            const minutes = parseInt(document.getElementById('minutesInput').value);
            if (minutes < 1 || minutes > 30) {
                alert('Inserisci un valore tra 1 e 30 minuti');
                return;
            }
            
            // Mostra caricamento
            document.getElementById('loadingMsg').style.display = 'block';
            document.getElementById('startBtn').disabled = true;
            
            // Carica le parole
            gameState.wordList = await loadWords();
            
            // Nascondi caricamento
            document.getElementById('loadingMsg').style.display = 'none';
            
            // Inizializza gioco
            gameState.score = 0;
            gameState.wordsCompleted = 0;
            gameState.timeLeft = minutes * 60;
            gameState.typedText = '';
            gameState.gameActive = true;
            gameState.currentWord = createNewWord();
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            updateTimer();
            updateScore();
            
            // Timer countdown
            const timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateTimer();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
            
            gameLoop();
        }
        
        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startGame);
        
        document.getElementById('restartBtn').addEventListener('click', () => {
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
        });
        
        document.addEventListener('keypress', (e) => {
            if (!gameState.gameActive || !gameState.currentWord) return;
            
            const char = e.key.toLowerCase();
            const expectedChar = gameState.currentWord.text[gameState.typedText.length];
            
            if (char === expectedChar) {
                // Lettera corretta
                gameState.typedText += char;
                
                // Parola completata
                if (gameState.typedText === gameState.currentWord.text) {
                    gameState.score += 5;
                    gameState.wordsCompleted++;
                    updateScore();
                    
                    // Nuova parola
                    gameState.currentWord = createNewWord();
                    gameState.typedText = '';
                }
            } else {
                // Lettera sbagliata - lampeggia rosso e resetta
                gameState.flashRed = true;
                gameState.flashCount = 0;
                gameState.typedText = '';
            }
        });
    </script>
</body>
</html>